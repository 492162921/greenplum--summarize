# Greenplum数据库巡检报告
	Greenplum数据库巡检报告.pdf主要是作者对Greenplum数据库巡检报告的总结，
	欢迎查看与交流，详细的文档PDF请下载:

https://github.com/xfg0218/greenplum--summarize/blob/master/greenplum%E5%AD%A6%E4%B9%A0pdf%E6%96%87%E6%A1%A3/Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B7%A1%E6%A3%80%E6%8A%A5%E5%91%8A.pdf


# 目录
	Greenplum数据库巡检报告.pdf主要是作者对Greenplum数据库巡检报告的总结

	1 巡检说明
	
	2 查看集群硬件相关信息
		2.1 查看集群当前系统时间
		2.2 查看操作系统版本
		2.3 查看内核版本
		2.4 查看内存的详细信息
			2.4.1 查看内存的使用情况
			2.4.2 查看实时的内存使用情况
		2.5 查看集群的 CPU 详细信息
			2.5.1 查看集群中 CPU 的核数
			2.5.2 实时查看 CPU 的使用情况
		2.6 查看集群的磁盘的详细信息
			2.6.1 查看集群磁盘使用空间
			2.6.2 动态查看磁盘的使用情况
		2.7 查看机器内核配置参数
		2.8 查看系统打开文件的最大数
		2.9 查看磁盘的挂在情况
		2.10 查看开机需要启动的项
		2.11 查看系统系统资源限制
		2.12 查看集群的网络的详细信息
			2.12.1 查看集群中网卡的大小
			2.12.2 动态查看网络的吞吐情况
			
	3 查看集群上运行的任务
		3.1 查看集群上运行的定时任务
			3.1.1 编写查看定时的脚本
			3.1.2 运行定时的脚本
		3.2 查看集群上运行 greenplum 的进程
		
	4 查看集群的基本信息
		4.1 查看集群的版本信息
		4.2 查看 segment 相关信息
			4.2.1 查看当前 down 的 segment 节点
			4.2.2 查看当前处于 change tracking 的 segment 节点
			4.2.3 查看当前处于 re-syncing 状态的 segment 节点
			4.2.4 查看所有 segment 是否可达,确保 QD(query dispatching)正常
		4.3 查看 standby 与 master 的信息
			4.3.1 查看 standby 的配置
			4.3.2 查看 standby 的运行状态
			4.3.3 查看 master 节点的是否正常
			4.3.4 检查 gp_persistent 表,确保主备 Segment 之间是否有数据不一致的问题
		4.4 查看有问题的 segment primary/mirror 信息
		4.5 显示 mirror 列表
		4.6 显示所有配置参数
		4.7 查看集群中数据库中的详细信息
			4.7.1 查看每个数据库占用的大小
			4.7.2 查看每个 schema 的占用大小
			4.7.3 查看 AO 表的相关信息
				4.7.3.1 查看数据库中的 AO 表
				4.7.3.2 查看数据库中的 AO 表的数量
			4.7.4 查看堆表的相关信息
				4.7.4.1 查看数据库中的堆表
				4.7.4.2 查看堆表的数量
			4.7.5 查看外部表相关信息
				4.7.5.1 查看外部表
				4.7.5.2 查看外部表的数量
			4.7.6 查看视图的相关信息
				4.7.6.1 查看制定 schema 下视图
				4.7.6.2 查看制定 schema 下视图的数量
			4.7.7 查看表的相关信息
				4.7.7.1 查看每个表的大小信息
		4.8 查看索引的相关信息
			4.8.1 查看索引大小超过表总大小 1/2 的系统表大小和索引大小
			4.8.2 查看制定 schema 上表的索引
			4.8.3 索引活跃度监控
				4.8.3.1 IO 活跃度查看
				4.8.3.2 访问活跃度.
				4.8.4 查看 Master 与 Segment 上索引不一致的问题
		4.9 检查是否使用了 a-z 0-9 _ 以外的字母作为对象名
			4.9.1 查看数据库是否使用了命名规范
			4.9.2 查看表的索引和视图的命名规范
			4.9.3 查看数据库中的类型命名规范
			4.9.4 查看数据库中的储存过程的命名规范
			4.9.5 查看数据库中的表,视图的的命名规范
		4.10 查看集群是否处于 not balanced 状态
			4.10.1 查看当前的连接数
			4.10.2 查看密码有效期不足 30 天的用户
			4.10.3 查看每个用户链接的个数
			4.10.4 查看数据库的连接数
		4.11 查看 ctid 的值
		
	5 集群巡检过程详细信息
		5.1 检查大小超过 1GB 的表倾斜情况
			5.1.1 查看超过 1GB 倾斜率的表
			5.1.2 查看表在 segment 上占用大小及倾斜率
			5.1.3 查看表在 segment 上占用的行数及百分比
			5.1.4 解决表分布倾斜的情况
				5.1.4.1 分布键说明
				5.1.4.2 修改分布键
				5.1.4.3 对表进行重新创建
		5.2 检查膨胀率过高的表
			5.2.1 查看 schema 下的 AO 表
			5.2.2 查看表的膨胀率
			5.2.3 对表进行释放空间
		5.3 检查元数据不一致问题
			5.3.1 问题描述
			5.3.2 集群检查
			5.3.3 问题处理
		5.4 查看服务器配置参数
			5.4.1 服务器 OS 参数查看
		5.5 查看集群参数详细信息
			5.5.1 查看每个 segment 的内存配置参数
				5.5.1.1 查看分配内存信息
				5.5.1.2 修改内存参数
			5.5.2 查看 shared_buffers(共享缓冲区)的内存
				5.5.2.1 查看系统配置的参数
				5.5.2.2 参数详解
				5.5.2.3 修改参数
			5.5.3 查看 max_connections(最大连接数)
				5.5.3.1 查看最大连接数参数
				5.5.3.2 参数详解
			5.5.4 查看 block_size(磁盘块)的大小
				5.5.4.1 查看磁盘块的大小
				5.5.4.2 参数详解
			5.5.5 查看 work_mem 的值
				5.5.5.1 查看集群中 work_mem 的配置大小
				5.5.5.2 参数详解
				5.5.5.3 修改参数
			5.5.6 查看 statement_mem 的值
				5.5.6.1 查看集群中 statement_mem 的值
				5.5.6.2 参数详解
				5.5.6.3 修改参数
			5.5.7 查看 gp_workfile_limit_files_per_query 的值
				5.5.7.1 查看此值的大小
				5.5.7.1 参数详解
			5.5.8 查看 gp_resqueue_priority_cpucores_per_segment 的值
				5.5.8.1 查看此值的大小
				5.5.8.2 参数详解
				5.5.8.3 修改参数
		5.6 备 Master 镜像情况
			5.6.1 概述
			5.6.2 查看备 master 的运行情况
			5.6.3 备 master 需要检测的项
		5.7 segment 镜像情况
			5.7.1 查看集群中的镜像分布情况
		5.8 资源队列情况
			5.8.1 用户与资源队列检查
				5.8.1.1 查看负载管理资源队列的状态和活动
				5.8.1.2 查看当前用户使用的是什么队列
				5.8.1.3 查看队列的活动负载状态
				5.8.1.4 查看负载管理特性的 Greenplum 数据库资源队列的信息
				5.8.1.5 查看队列资源的状态
				5.8.1.6 查看每个资源队列的配置情况
				5.8.1.7 修改资源队列的语句
		5.9 Statistics 状态检查
			5.9.1 查看所有的表
			5.9.2 查看指定 schema 下的表
		5.10 Skew 状态检查
		5.11 Bloat 状态
		5.12 集群系统性能
			5.12.1 DB 性能查看
			5.12.2 SQL 锁检
			5.12.3 集群硬件性能查看
		5.13 查看集群系统元数据
		5.14 查看集群中分布键倾斜率比较高的表
		5.15 使用 gpcheckcat 命令检测集群
			5.15.1 gpcheckcat 检测项说明
			5.15.2 检查 master,segment 的 catalog 一致性
			5.15.3 检查持久化表的 catalog 一致性
			5.15.4 检查 pg_class 与 pg_attribute 是否不一致
		5.16 表活跃度监控
			5.16.1 IO 活跃度的表
			5.16.2 表的访问活跃度